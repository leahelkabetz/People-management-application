<mat-card class="panel" dir="rtl">
    <div class="panel__header">
        <mat-form-field appearance="fill" class="panel__search">
            <mat-icon matPrefix class="search-icon">search</mat-icon>
            <input matInput placeholder="חפש..." [(ngModel)]="filterValue" (input)="applyFilter()" />
        </mat-form-field>
    </div>
    <div class="panel__divider"></div>
    <div class="table-wrap">
        <table mat-table [dataSource]="data" matSort class="people-table">
            <ng-container matColumnDef="firstName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>שם פרטי</th>
                <td mat-cell *matCellDef="let p">
                    <ng-container *ngIf="editingId === p.id; else viewFirst">
                        <input matInput [(ngModel)]="editData.firstName" [attr.size]="(editData.firstName?.length || 1)"
                            class="fit-input" />
                    </ng-container>
                    <ng-template #viewFirst>{{ p.firstName }}</ng-template>
                </td>
            </ng-container>
            <ng-container matColumnDef="lastName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>שם משפחה</th>
                <td mat-cell *matCellDef="let p">
                    <ng-container *ngIf="editingId === p.id; else viewLast">
                        <input matInput [(ngModel)]="editData.lastName" [attr.size]="(editData.lastName?.length || 1)"
                            class="fit-input" />
                    </ng-container>
                    <ng-template #viewLast>{{ p.lastName }}</ng-template>
                </td>
            </ng-container>
            <ng-container matColumnDef="identityNumber">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>ת"ז</th>
                <td mat-cell *matCellDef="let p">
                    <ng-container *ngIf="editingId === p.id; else viewId">
                        <input matInput [(ngModel)]="editData.identityNumber" [attr.size]="(editData.identityNumber?.length || 1)"
                            class="fit-input" />
                    </ng-container>
                    <ng-template #viewId>{{ p.identityNumber | secureId }}</ng-template>
                </td>
            </ng-container>
            <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>אימייל</th>
                <td mat-cell *matCellDef="let p" class="email-cell">
                    <ng-container *ngIf="editingId === p.id; else viewEmail">
                        <input matInput [(ngModel)]="editData.email" [attr.size]="(editData.email?.length || 1)"
                            class="fit-input" />
                    </ng-container>
                    <ng-template #viewEmail>{{ p.email }}</ng-template>
                </td>
            </ng-container>
            <ng-container matColumnDef="phone">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>טלפון</th>
                <td mat-cell *matCellDef="let p">
                    <ng-container *ngIf="editingId === p.id; else viewPhone">
                        <input matInput [(ngModel)]="editData.phoneNumber" [attr.size]="(editData.phoneNumber?.length || 1)"
                            class="fit-input" />
                    </ng-container>
                    <ng-template #viewPhone>{{ p.phoneNumber }}</ng-template>
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let p" class="actions">
                    <ng-container *ngIf="editingId !== p.id; else editingButtons">
                        <button mat-icon-button matTooltip="עריכה" (click)="startEdit(p)">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button matTooltip="מחיקה" (click)="confirmDelete(p)">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </ng-container>
                    <ng-template #editingButtons>
                        <button mat-icon-button matTooltip="שמירה" (click)="requestSave()">
                            <mat-icon>check</mat-icon>
                        </button>
                        <button mat-icon-button matTooltip="ביטול" (click)="cancelEdit()">
                            <mat-icon>close</mat-icon>
                        </button>
                    </ng-template>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns; trackBy: trackById"></tr>
        </table>
    </div>
    <div class="loading" *ngIf="loading">
        <mat-progress-spinner mode="indeterminate" diameter="54"></mat-progress-spinner>
    </div>
</mat-card>
